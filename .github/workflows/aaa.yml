name: aaa

on:
  pull_request:
    types: [opened, reopened, synchronize]
    branches: [master]
    paths:
      - .github/workflows/aaa.yml

jobs:
  test:
    runs-on: windows-latest
    timeout-minutes: 2

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install
        run: |
          $debug = if ($env:RUNNER_DEBUG) { "--verbose --debug" }
          choco install -y -i --no-progress ilspy psinfo nircmd $debug
          if ($LASTEXITCODE -in 1641, 3010) { exit 0 }
          nircmd savescreenshotfull desktop.install.png

      - name: Test
        run: ./test.ps1
        env:
          test_cases: |
            - psinfo
              Invoke-Program psinfo -ScreenshotPrefix desktop
            - Start program
              Start-Program ILSpy -ScreenshotPrefix desktop
            - Close program
              Close-Program ILSpy -ScreenshotPrefix desktop


      - name: Upload screenshots
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: Screenshots
          path: desktop.*.png
